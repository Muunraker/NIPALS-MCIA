---
title: "Analysis of MCIA Decomposition"
author: "Max Mattessich, Joaquin Reyna, Edel Aron, Anna Konstorum"
date: "Compiled: `r format(Sys.time(), '%d %B %Y')`"
header-includes:
   - \usepackage{amsmath}
   - \usepackage{amsfonts}
output: 
    rmdformats::readthedown:
      toc_depth: 4
vignette: >
  %\VignetteIndexEntry{Analysis-of-MCIA-Decomposition}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

\newcommand{\mb}[1]{\mathbf{#1}}
\newcommand{\var}{\text{var}}
\newcommand{\cov}{\text{cov}}

```{r setup-merger, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(42) # NIPALS starts with a random vector
```

```{r, echo = FALSE, include = FALSE}
library(ComplexHeatmap)
library(dplyr)
library(fgsea)
library(ggplot2)
library(ggpubr)
library(nipalsMCIA)
library(stringr)
```

```{r, warning = FALSE, message = FALSE}
# load the dataset which uses the name data_blocks
data(NCI60)

mcia_results <- nipals_multiblock(data_blocks, preproc_method = "colprofile",
                                  num_PCs = 10, tol = 1e-12, plots = "none")
```

```{r, warning = FALSE, message = FALSE, fig.dim = c(8, 4), fig.align = 'center'}
set.seed(42)

mcia_results <- nipals_multiblock(data_blocks, preproc_method = "colprofile",
                                  num_PCs = 10, tol = 1e-12)
```


```{r, fig.dim = c(4, 4), fig.align = 'center'}
svg("global_factor_plot.svg")
projection_plot(mcia_results, "global", cex=1.5, color_override='#e0b21bff', orders = c(1, 2))
dev.off()
```


```{r, fig.dim = c(4, 4), fig.align = 'center'}
svg("block_factor_plot.mrna.svg")
projection_plot(mcia_results, "block", block_name = 'mrna', cex=1.5, color_override='#3a8ac2ff', orders = c(1, 2))
dev.off()
```
```{r, fig.dim = c(4, 4), fig.align = 'center'}
svg("block_factor_plot.miRNA.svg")
projection_plot(mcia_results, "block", block_name = 'miRNA', cex=1.5, color_override='#d2374bff', orders = c(1, 2))
dev.off()
```
```{r, fig.dim = c(4, 4), fig.align = 'center'}
svg("block_factor_plot.prot.svg")
projection_plot(mcia_results, "block", block_name = 'prot', cex=1.5, color_override='#368b5cff', orders = c(1, 2))
dev.off()
```

```{r error=TRUE}
projection_plot(mcia_results, "block", block_name = 'fail', cex=1.5, orders = c(1, 2))
```


Testing functions
```{r}
f = function(a=1,b=2,...){
    t = list(...)
    print(paste(a,b,...))
    print(match.call())
    print(sys.call())
    print(t)

}
f(3,4,c=5,d=6,e=7)
```


