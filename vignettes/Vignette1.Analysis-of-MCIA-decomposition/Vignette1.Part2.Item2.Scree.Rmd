---
header-includes:
   - \usepackage{amsmath}
   - \usepackage{amsfonts}
output:
  html_document: default
---

\newcommand{\mb}[1]{\mathbf{#1}}
\newcommand{\var}{\text{var}}
\newcommand{\cov}{\text{cov}}

```{r setup-V1-P2-I2, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(42) # NIPALS starts with a random vector
```

```{r, echo = FALSE, include = FALSE}
library(ggpubr)
library(nipalsMCIA)
library(ggplot2)
```

<!-- Loading NCI60 data and running nipals_multiblock()
     whenever running from individual Rmarkdowns -->
```{r child = "Load-Shared-Vars.Rmd", include = FALSE}
```

### Visualize all feature loadings on two axes
MCIA returns feature loadings for each factor that can be used to understand 
important contributions of multi-omic features to a given factor.  
To get a sense of which omics features show highest contribution to 
each factor, one can plot feature loadings for any two omics using the 
`vis_load_plot` function.

```{r}
colors_omics <- get_colors(mcia_results)
vis_load_plot(mcia_results, axes = c(1, 4), colors_omics)
```

### Scree Plot: Visualizing the top features per factor
For a given factor, users can return and visualize a ranked list of top magnitude features.  
Features can be ranked based on the users preference: either by absolute value, ascending,
or descending values.  All features, or features in a given omic can be ranked.  
The `ord_loadings` function returns a ranked list, and `vis_load_ord` allows users to 
visualize the features loadings as a scree plot.

#### Factor 1
Here, we return and visualize two ranked lists for Factor 1: using all omics, or just mrna.

```{r, fig.width = 10, fig.height = 5}
# define the loadings
all_pos_1 <- ord_loadings(mcia_out = mcia_results, omic = "all", 
                          absolute = FALSE, descending = TRUE, factor = 1)
mrna_pos_1 <- ord_loadings(mcia_out = mcia_results, omic = "mrna", 
                           absolute = FALSE, descending = TRUE, factor = 1)

# visualization
all_pos_1_vis <- vis_load_ord(gl_f_ord = all_pos_1, colors_omics = colors_omics)
mrna_pos_1_vis <- vis_load_ord(gl_f_ord = mrna_pos_1, colors_omics = colors_omics)

ggarrange(all_pos_1_vis, mrna_pos_1_vis)
```

#### Factor 2
Here, we return and visualize two ranked lists for Factor 2: using all omics, or just protein,
this time ranking features by magnitude (absolute value).

```{r, fig.width = 10, fig.height = 5}
# define the loadings
all_abs_2 <- ord_loadings(mcia_out = mcia_results, omic = "all", 
                          absolute = TRUE, descending = TRUE, factor = 2)
prot_abs_2 <- ord_loadings(mcia_out = mcia_results, omic = "prot", 
                           absolute = TRUE, descending = TRUE, factor = 2)

# visualization
all_abs_2_vis <- vis_load_ord(gl_f_ord = all_abs_2, colors_omics = colors_omics)
prot_abs_2_vis <- vis_load_ord(gl_f_ord = prot_abs_2, colors_omics = colors_omics)

ggarrange(all_abs_2_vis, prot_abs_2_vis)
```

#### Factor 4
We return and visualize a ranked list for Factor 4 with the top 60 features.  One can observe that while miRNA dominate the top features, all omics are represented.

```{r, fig.width = 10, fig.height = 4}
all_4 <- ord_loadings(mcia_results, omic = "all", absolute = FALSE, 
                      descending = TRUE, factor = 4)
all_4_plot <- vis_load_ord(gl_f_ord = all_4, colors_omics = colors_omics, 
                           n_feat = 60)

all_4_plot
```