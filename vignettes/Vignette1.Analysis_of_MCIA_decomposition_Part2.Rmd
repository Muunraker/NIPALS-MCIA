---
title: "Vignette 1 - Understanding the Results of MCIA"
author:
    - Max Mattessich
    - Joaquin Reyna
    - Anna Konstorum
date: "9/1/2022"
output:
  pdf_document: default
  html_document: default
---

\newcommand{\mb}[1]{\mathbf{#1}}
\newcommand{\var}{\text{var}}
\newcommand{\cov}{\text{cov}}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(42) # NIPALS starts with a random vector
```

```{r, echo=FALSE, include=FALSE}
library(nipalsMCIA)
library(ggplot2)
```

### Running MCIA on NCI60 Data and Basic Visualization

`NIPALS-MCIA` includes a sample multi-omics dataset modified from data collected on the NCI-60 cancer cell lines [CITE: Meng, 2016]. This can be used to illustrate low-dimensional plotting with the global factors.


First, we compute the first 10 global factors for the dataset:
```{r,warning=FALSE,message=FALSE,fig.height=3}
data(NCI60) # this creates the dataset as `data_blocks`
mcia_results <- nipals_multiblock(data_blocks, preprocMethod='colprofile', num_PCs = 10, tol=1e-12)
```
\newpage

## Part 2: Interpreting Global Loadings

### Pseudoeigenvalues representing the contribution of each omic to the global factor score
```{r, fig.width=4, fig.height=1.5}
## Should make into a function
bs_weights<-as.matrix(data.frame(mcia_results$block_score_weights))
colnames(bs_weights)<-c(1:10)
ComplexHeatmap::Heatmap(bs_weights, cluster_columns=FALSE, cluster_rows=FALSE,
                        column_title_side = "bottom", column_title = "Factor")
```


### Scree Plot: Visualizing the top features per factor
```{r, fig.height=2.5, fig.width=5.5}
# make into function
gl<-mcia_results$global_loadings
omic_list<-gsub("^.*_", "", rownames(gl))
factor<-4
gl_f<-data.frame(gl[,factor])
gl_f$omic<-omic_list
colnames(gl_f)<-c("weight",'omic')
gl_f_ord<-gl_f[order(gl_f$weight, decreasing=TRUE),]

# look at mRNA (need to filter since issue with miRNA omic name)
gl_f_ord_mRNA<-gl_f_ord[gl_f_ord$omic=="mrna",]
omic_name<-sub("_.*", "",rownames(gl_f_ord_mRNA) )
gl_f_ord_mRNA$omic_name<-sub("_.*", "",rownames(gl_f_ord_mRNA) )
ggplot(gl_f_ord_mRNA[0:30,], aes(x=factor(omic_name,level=omic_name), y=weight))+
      geom_point()+
      theme_bw()+
      xlab('Feature')+
      theme(axis.text.x=element_text(angle=45, hjust=1))
```
